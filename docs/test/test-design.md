# anotoki テスト設計書

## 1. 概要
- 対象: 認証フロー、投稿 CRUD、カテゴリフィルター、リアクション、UI 表示
- 目的: 正常系/異常系/境界値を網羅し、回帰リスクを低減する
- テストレベル:
  - ユニットテスト (Jest): バリデーション、APIレスポンスユーティリティ、サーバーアクション
  - E2Eテスト (Playwright): 主要画面の表示、保護ルーティングの動作確認

## 2. テスト項目

### 2.1 認証
| ID | 観点 | 期待結果 | 手段 |
|---|---|---|---|
| AUTH-01 | 未認証アクセス | `/login` にリダイレクトされる | Playwright (保護ルート) |
| AUTH-02 | ログイン画面表示 | Google ログイン CTA が表示される | Playwright |

### 2.2 投稿バリデーション (ユニット)
| ID | 観点 | 入力 | 期待結果 |
|---|---|---|---|
| VAL-01 | 正常系 | 最小構成の有効な投稿 | 正常にパースされトリムされる |
| VAL-02 | 異常系 | タイトル2文字 | エラーコード `title.min` を返す |
| VAL-03 | 境界値 | タグ6件 | エラーコード `tags.max` を返す |

### 2.3 投稿クエリ (ユニット)
| ID | 観点 | 入力 | 期待結果 |
|---|---|---|---|
| QRY-01 | 正常系 | limit=“5” | 数値 5 に変換される |
| QRY-02 | 異常系 | limit=“0” | `limit.range` エラー |
| QRY-03 | タグフィルタ | tag=“career” | フィルタ条件に反映 |

### 2.4 API レスポンスユーティリティ (ユニット)
| ID | 観点 | 操作 | 期待結果 |
|---|---|---|---|
| API-01 | 正常レスポンス | `jsonOk({ ok: true })` | status=200, payload一致 |
| API-02 | エラーレスポンス | `jsonError({ status:403,... })` | status=403, フォーマット統一 |

### 2.5 UI / UX (E2E)
| ID | 観点 | 手順 | 期待結果 |
|---|---|---|---|
| UI-01 | ログイン画面 | `/login` にアクセス | ロゴテキストとボタンを表示 |
| UI-02 | レスポンシブ | ビューポート幅 375px | ログイン CTA が折り返さず表示 |

### 2.6 フィルター (今後のE2E拡張)
- カテゴリ変更でフィード更新
- タグ Chip クリックでタグ検索へ遷移

## 3. カバレッジ目標
- ユニット: 主要バリデーション・ユーティリティの分岐網羅
- E2E: 認証画面・保護ルーティングの Smoke テスト
- カバレッジ閾値: Lines 70% / Statements 70% (初期ベースライン)

## 4. 前提条件
- `.env.local` に Google OAuth / MongoDB 設定
- テスト用ユーザーは Google OAuth を介して作成
- Playwright 実行時に `pnpm dev` が利用可能

## 5. メンテナンス指針
- 仕様変更時は本ドキュメントを更新し、テストケースの追加/削除を必ず実施
- 回帰バグは必ず JSTest/E2E に再現ケースを追加
