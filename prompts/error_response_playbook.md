# エラーレスポンス・プレイブック（テンプレ）
## 目的
- どんなエラーでも最短で原因を絞り込み、再発防止まで一気通貫で進める。
## タスク内容
- 事象の一次情報収集（ログ/メトリクス/環境差）
- 再現最短ケースの切り出し
- 原因仮説→検証→修正→再実行の反復
- 回帰防止（テスト/監視/ドキュメント）
## 使うタイミング
- ビルド/実行/テスト/本番でエラーを検知したとき全般
## 入力
- 事象メモ: {発生環境/stage, 発生時刻, 操作手順}
- 失敗ログ: {抜粋/スクショ/スタックトレース}
- 関連差分: {直近PR/依存更新/設定変更}
## 手順（S-T-R-F ループ：Symptom→Triaging→Remedy→Fortify）
1) **Symptom（症状確定）**
   - 事象を1文に圧縮: 「{誰が/どこで/何をしたら/何が起きた}」
   - 影響範囲: {ユーザー件数/売上影響/機能範囲}
2) **Triaging（切り分け）**
   - 分類: {ビルド/型/ランタイム/依存/データ/ネットワーク/権限}
   - どこで壊れたか: {Client/SSR/API/DB/ジョブ/CI}
   - 既知変更の照合: {直近コミット/設定/インフラ}
3) **Remedy（最小修正）**
   - 再現最短ケースを作成（ユニット or e2e）
   - 仮説→修正→再実行を反復（コミットは小さく、因果を残す）
   - 一時回避が有効なら切替（Feature Flag / Rollback / 再デプロイ）
4) **Fortify（堅牢化）**
   - 再発防止テストを追加（ユニット/結合/e2eの最短1本）
   - ログ/メトリクス/アラートを増強（相関ID/閾値）
   - `docs/specs/{領域}.md` に「原因/対策/影響」を追記
## 出力
- 修正PR（原因/対策/再現手順/テスト結果をPR本文に記載）
- テストの追加/更新（赤→緑の証跡）
- ドキュメント更新（変更履歴・運用メモ）
## よくある原因マップ（ヒント）
- **Client/SSR境界**: ブラウザAPIをサーバーで呼んだ/`use client` 漏れ
- **型/スキーマ**: Null許容の見落とし、バージョン差で型崩れ
- **依存**: マイナー更新で破壊的変更/ツリーシェイキング影響
- **ネットワーク**: CORS/タイムアウト/指数バックオフ未設定
- **データ**: インデックス不足/N+1/外部IDの一意制約違反
- **権限**: IAMポリシー/トークン範囲/ロール誤設定
## サンプル（ダミー）
- 事象: 「検証環境で決済完了画面が 500。直近で `/v2/payments` にパラメータ追加」
- 対応: リクエストボディの必須化が本番APIと不一致→サーバー側バリデ追加＋e2e一本追加